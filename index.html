<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopSphere - Modern E-Commerce</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@0.292.0/dist/umd/lucide.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        // Custom Tailwind CSS Configuration
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#0d9488', // A rich teal
                        'primary-dark': '#0f766e',
                        'secondary': '#f5f3f0', // A soft, warm off-white
                        'accent': '#facc15', // A vibrant yellow for highlights
                        'charcoal': '#1f2937', // A dark gray for text
                        'charcoal-light': '#4b5563',
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f3f0;
            color: #1f2937;
        }
        .page { display: none; }
        .page.active { display: block; }
        .filter-btn.active {
            background-color: #0d9488; /* primary */
            color: white;
        }
        .star {
            color: #fde047; /* yellow-300 */
            cursor: pointer;
        }
        .star.filled {
             color: #facc15; /* accent */
        }
         .star-display {
            color: #facc15; /* accent */
        }
        #review-confirmation {
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0"><a href="#" class="text-2xl font-bold text-charcoal nav-link" data-target="home">ShopSphere</a></div>
                <nav class="hidden md:flex items-center space-x-6">
                    <a href="#" class="text-charcoal-light hover:text-primary transition-colors nav-link" data-target="home">Home</a>
                    <a href="#" class="text-charcoal-light hover:text-primary transition-colors nav-link" data-target="shop">Shop</a>
                </nav>
                <div class="flex items-center space-x-4">
                    <button class="text-charcoal-light hover:text-primary"><i data-lucide="search" class="w-5 h-5"></i></button>
                    <a href="#" class="text-charcoal-light hover:text-primary nav-link" data-target="profile"><i data-lucide="user" class="w-5 h-5"></i></a>
                    <a href="#" class="relative text-charcoal-light hover:text-primary nav-link" data-target="cart">
                        <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-primary text-white text-xs w-4 h-4 rounded-full flex items-center justify-center">0</span>
                    </a>
                    <button id="mobile-menu-button" class="md:hidden text-charcoal-light hover:text-primary"><i data-lucide="menu" class="w-6 h-6"></i></button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
            <nav class="flex flex-col p-4 space-y-2">
                <a href="#" class="text-charcoal-light hover:bg-secondary p-2 rounded-md nav-link" data-target="home">Home</a>
                <a href="#" class="text-charcoal-light hover:bg-secondary p-2 rounded-md nav-link" data-target="shop">Shop</a>
                <a href="#" class="text-charcoal-light hover:bg-secondary p-2 rounded-md nav-link" data-target="profile">Profile</a>
                <a href="#" class="text-charcoal-light hover:bg-secondary p-2 rounded-md nav-link" data-target="cart">Cart</a>
            </nav>
        </div>
    </header>

    <main>
        <div id="home" class="page active">
            <section class="relative bg-charcoal text-white"><div class="absolute inset-0"><img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&w=1740&q=80" alt="Retail store interior" class="w-full h-full object-cover opacity-40"></div><div class="relative container mx-auto px-4 lg:px-8 py-24 md:py-32 text-center"><h1 class="text-4xl md:text-6xl font-bold mb-4 tracking-tight text-white">Style for Every Story</h1><p class="text-lg md:text-xl max-w-2xl mx-auto mb-8 text-gray-300">Discover curated collections that celebrate your unique style.</p><a href="#" class="bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-8 rounded-lg text-lg transition-transform transform hover:scale-105 nav-link" data-target="shop">Explore Collections</a></div></section>
            <section class="bg-white py-16 sm:py-20"><div class="container mx-auto px-4 lg:px-8"><div class="grid grid-cols-1 md:grid-cols-3 gap-12 text-center"><div class="flex flex-col items-center"><div class="bg-primary/10 p-4 rounded-full mb-4"><i data-lucide="truck" class="w-8 h-8 text-primary"></i></div><h3 class="text-xl font-bold text-charcoal mb-2">Free Shipping</h3><p class="text-charcoal-light">Enjoy free shipping on all orders over $50.</p></div><div class="flex flex-col items-center"><div class="bg-primary/10 p-4 rounded-full mb-4"><i data-lucide="shield-check" class="w-8 h-8 text-primary"></i></div><h3 class="text-xl font-bold text-charcoal mb-2">Secure Payments</h3><p class="text-charcoal-light">Your payments are processed securely.</p></div><div class="flex flex-col items-center"><div class="bg-primary/10 p-4 rounded-full mb-4"><i data-lucide="award" class="w-8 h-8 text-primary"></i></div><h3 class="text-xl font-bold text-charcoal mb-2">Quality Guarantee</h3><p class="text-charcoal-light">We stand by the quality of our products.</p></div></div></div></section>
            <section class="py-16 sm:py-20"><div class="container mx-auto px-4 lg:px-8"><h2 class="text-3xl font-bold text-center text-charcoal mb-10">Featured Products</h2><div id="featured-product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8"></div></div></section>
        </div>

        <div id="shop" class="page"><div class="container mx-auto px-4 lg:px-8 py-12"><h1 class="text-3xl font-bold text-charcoal mb-8">All Products</h1><div id="filter-container" class="flex flex-wrap gap-2 mb-8"></div><div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8"></div></div></div>

        <div id="product-detail" class="page"><div class="container mx-auto px-4 lg:px-8 py-12"><div id="product-detail-content"></div></div></div>

        <div id="cart" class="page"><div class="container mx-auto px-4 lg:px-8 py-12"><h1 class="text-3xl font-bold text-charcoal mb-8">Your Shopping Cart</h1><div class="lg:flex lg:gap-8"><div id="cart-items-container" class="lg:w-2/3"></div><div id="cart-summary-container" class="lg:w-1/3 mt-8 lg:mt-0"><div id="cart-summary" class="bg-white p-6 rounded-lg shadow-md sticky top-24"></div></div></div></div></div>

        <div id="profile" class="page"><div class="container mx-auto px-4 lg:px-8 py-12"><h1 class="text-3xl font-bold text-charcoal mb-8">My Account</h1><div class="bg-white p-8 rounded-lg shadow-md max-w-2xl mx-auto"><div class="flex items-center space-x-6 mb-8"><img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=100&q=80" alt="User Avatar" class="w-24 h-24 rounded-full object-cover"><div><h2 class="text-2xl font-semibold text-charcoal">Emily Carter</h2><p class="text-charcoal-light">emily.carter@example.com</p></div></div><div class="space-y-6"><div><h3 class="text-lg font-semibold text-charcoal mb-2">Order History</h3><p class="text-charcoal-light">You have no recent orders.</p></div><div><h3 class="text-lg font-semibold text-charcoal mb-2">Account Details</h3><button class="bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-4 rounded-lg">Edit Profile</button></div><div><h3 class="text-lg font-semibold text-charcoal mb-2">Settings</h3><button class="text-red-600 hover:text-red-800 font-semibold">Logout</button></div></div></div></div></div>
    </main>
    
    <footer class="bg-charcoal text-gray-300 mt-16"><div class="container mx-auto px-4 lg:px-8 py-12"><div class="border-t border-gray-700 pt-6 text-center text-gray-500"><p>&copy; 2024 ShopSphere. All Rights Reserved.</p></div></div></footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA ---
            const products = [
                { id: 1, name: 'Chronos Smartwatch', price: 299.00, image: 'https://images.unsplash.com/photo-1546868871-7041f2a55e12?auto=format&fit=crop&w=800&q=80', category: 'Electronics', rating: 4.8, reviews: 120, description: 'A stylish and powerful smartwatch to keep you connected.', sampleReviews: [{rating: 5, author: 'Alex J.', date: '2024-07-15', comment: 'Absolutely love it! The battery life is amazing and it looks so sleek.'}, {rating: 4, author: 'Maria S.', date: '2024-07-10', comment: 'Great watch, but the strap could be more comfortable.'}] },
                { id: 2, name: 'Aura Headphones', price: 149.00, image: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=800&q=80', category: 'Electronics', rating: 4.6, reviews: 98, description: 'Immerse yourself in high-fidelity sound.', sampleReviews: [{rating: 5, author: 'David L.', date: '2024-06-28', comment: 'The noise cancellation is top-notch. Perfect for my commute.'}] },
                { id: 3, name: 'Nomad Leather Backpack', price: 189.00, image: 'https://images.pexels.com/photos/3155047/pexels-photo-3155047.jpeg?auto=format&fit=crop&w=800&q=80', category: 'Accessories', rating: 4.9, reviews: 215, description: 'Crafted from genuine leather for your adventures.', sampleReviews: [{rating: 5, author: 'Jessica P.', date: '2024-07-20', comment: 'Stunning backpack. The quality of the leather is incredible and it has so many useful pockets.'}, {rating: 5, author: 'Tom B.', date: '2024-07-18', comment: 'Best backpack I have ever owned. Worth every penny.'}] },
                { id: 4, name: 'Eclipse Sunglasses', price: 79.00, image: 'https://images.unsplash.com/photo-1511499767150-a48a237f0083?auto=format&fit=crop&w=800&q=80', category: 'Accessories', rating: 4.5, reviews: 75, onSale: true, description: 'Protect your eyes with style and 100% UV protection.', sampleReviews: [{rating: 4, author: 'Samantha G.', date: '2024-05-30', comment: 'Very stylish and lightweight. I wish they came with a harder case.'}] },
                { id: 5, name: 'Modern Ceramic Vase', price: 45.00, image: 'https://images.pexels.com/photos/6633404/pexels-photo-6633404.jpeg?auto=format&fit=crop&w=800&q=80', category: 'Home Goods', rating: 4.7, reviews: 62, description: 'A beautiful minimalist vase to add a touch of elegance.', sampleReviews: [{rating: 5, author: 'Olivia W.', date: '2024-07-05', comment: 'Looks perfect on my mantlepiece. The matte finish is very chic.'}] },
                { id: 6, name: 'Cozy Knit Blanket', price: 89.00, image: 'https://images.unsplash.com/photo-1580301762395-21ce84d00bc6?auto=format&fit=crop&w=800&q=80', category: 'Home Goods', rating: 4.8, reviews: 150, description: 'Stay warm with this ultra-soft, chunky knit blanket.', sampleReviews: [{rating: 5, author: 'Ben K.', date: '2024-06-12', comment: 'So soft and warm! My new favorite blanket for movie nights.'}] },
                { id: 7, name: 'Classic White Tee', price: 29.00, image: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?auto=format&fit=crop&w=800&q=80', category: 'Apparel', rating: 4.4, reviews: 88, description: 'A timeless wardrobe staple made from 100% organic cotton.', sampleReviews: [{rating: 4, author: 'Chloe T.', date: '2024-07-11', comment: 'Great quality cotton, but it runs a little large.'}] },
                { id: 8, name: 'Denim Jacket', price: 110.00, image: 'https://images.pexels.com/photos/2344601/pexels-photo-2344601.jpeg?auto=format&fit=crop&w=800&q=80', category: 'Apparel', rating: 4.9, reviews: 301, onSale: true, description: 'The perfect layering piece for any season.', sampleReviews: [{rating: 5, author: 'Michael R.', date: '2024-07-22', comment: 'I wear this jacket everywhere. It fits perfectly and the denim is high quality.'}] }
            ];    
            let cart = [];
            let currentProductId = null;

            const elements = {
                pages: document.querySelectorAll('.page'),
                navLinks: document.querySelectorAll('.nav-link'),
                mobileMenuButton: document.getElementById('mobile-menu-button'),
                mobileMenu: document.getElementById('mobile-menu'),
                productListContainer: document.getElementById('product-list'),
                featuredProductListContainer: document.getElementById('featured-product-list'),
                productDetailContainer: document.getElementById('product-detail-content'),
                cartItemsContainer: document.getElementById('cart-items-container'),
                cartSummaryContainer: document.getElementById('cart-summary'),
                cartCountElement: document.getElementById('cart-count'),
                filterContainer: document.getElementById('filter-container'),
            };

            const showPage = (pageId) => {
                elements.pages.forEach(page => page.classList.toggle('active', page.id === pageId));
                window.scrollTo(0, 0);
                elements.mobileMenu.classList.add('hidden');
            };

            const renderStars = (rating, isDisplayOnly = false) => {
                let starsHTML = '';
                const fullStars = Math.floor(rating);
                const halfStar = !isDisplayOnly ? false : rating % 1 >= 0.5;
                const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
                for (let i = 0; i < fullStars; i++) 
                    starsHTML += `<i data-lucide="star" class="w-4 h-4 ${isDisplayOnly ? 'star-display' : 'star filled'} fill-current" data-index="${i + 1}"></i>`;
                if (halfStar) 
                    starsHTML += `<i data-lucide="star-half" class="w-4 h-4 star-display fill-current"></i>`;
                for (let i = 0; i < emptyStars; i++) 
                    starsHTML += `<i data-lucide="star" class="w-4 h-4 ${isDisplayOnly ? 'text-gray-300' : 'star'}" data-index="${fullStars + i + 1}"></i>`;
                return starsHTML;
            };

            const renderProductCard = (product) => `
                <div class="bg-white rounded-lg shadow-md overflow-hidden group">
                    <div class="relative"><img src="${product.image}" alt="${product.name}" class="w-full h-64 object-cover">${product.onSale ? '<div class="absolute top-2 left-2 bg-accent text-charcoal text-xs font-bold px-2 py-1 rounded">SALE</div>' : ''}<div class="absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity"><button class="view-product-btn bg-white text-charcoal p-3 rounded-full hover:bg-primary hover:text-white transition-colors" data-id="${product.id}"><i data-lucide="eye" class="w-5 h-5"></i></button><button class="add-to-cart-btn bg-white text-charcoal p-3 rounded-full hover:bg-primary hover:text-white transition-colors" data-id="${product.id}"><i data-lucide="shopping-cart" class="w-5 h-5"></i></button></div></div>
                    <div class="p-4"><h3 class="font-semibold text-charcoal">${product.name}</h3><div class="flex items-center mt-1"><div class="flex items-center">${renderStars(product.rating, true)}</div><span class="text-xs text-charcoal-light ml-2">(${product.reviews})</span></div><p class="text-primary font-bold mt-2">$${product.price.toFixed(2)}</p></div>
                </div>`;

            const renderShopPage = (category = 'All') => {
                const filteredProducts = category === 'All' ? products : products.filter(p => p.category === category);
                elements.productListContainer.innerHTML = filteredProducts.map(renderProductCard).join('');
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.category === category));
                lucide.createIcons();
            };

            const renderHomePage = () => {
                const featuredProducts = products.filter(p => p.onSale || p.rating > 4.8).slice(0, 4);
                elements.featuredProductListContainer.innerHTML = featuredProducts.map(renderProductCard).join('');
                lucide.createIcons();
            };

            const renderReviews = (product) => {
                if (!product.sampleReviews || product.sampleReviews.length === 0) {
                    return '<p class="text-charcoal-light">No reviews yet.</p>';
                }
                return product.sampleReviews.map(review => `
                    <div class="border-t border-gray-200 pt-4 mt-4">
                        <div class="flex items-center mb-1">
                            <div class="flex">${renderStars(review.rating, true)}</div>
                            <h4 class="font-semibold text-charcoal ml-3">${review.author}</h4>
                            ${review.isNew ? '<span class="ml-2 bg-green-100 text-green-800 text-xs font-medium px-2 py-0.5 rounded">New</span>' : ''}
                        </div>
                        <p class="text-xs text-gray-500 mb-2">${review.date}</p>
                        <p class="text-charcoal-light">${review.comment}</p>
                    </div>
                `).join('');
            };

            const renderProductDetailPage = (productId) => {
                currentProductId = parseInt(productId);
                const product = products.find(p => p.id === currentProductId);
                if (!product) return;
                elements.productDetailContainer.innerHTML = `
                    <button class="nav-link mb-8 flex items-center gap-2 text-charcoal-light hover:text-primary font-semibold" data-target="shop"><i data-lucide="arrow-left" class="w-4 h-4"></i> Back to Shop</button>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-start">
                        <div><img src="${product.image}" alt="${product.name}" class="w-full rounded-lg shadow-md object-cover"></div>
                        <div><h1 class="text-4xl font-bold text-charcoal mb-2">${product.name}</h1><div class="flex items-center gap-2 mb-4"><div class="flex items-center">${renderStars(product.rating, true)}</div><a href="#reviews" class="text-charcoal-light hover:text-primary">${product.reviews} reviews</a></div><p class="text-3xl text-primary font-bold mb-6">$${product.price.toFixed(2)}</p><p class="text-charcoal-light mb-6">${product.description}</p><button class="add-to-cart-btn w-full bg-primary text-white py-3 rounded-lg hover:bg-primary-dark transition-colors text-lg" data-id="${product.id}">Add to Cart</button></div>
                    </div>
                    <div id="reviews" class="mt-16">
                        <h2 class="text-2xl font-bold text-charcoal mb-6">Customer Reviews</h2>
                        <div id="review-list" class="bg-white p-6 rounded-lg shadow-md mb-8">
                            ${renderReviews(product)}
                        </div>
                        <h3 class="text-xl font-bold text-charcoal mb-4">Write a Review</h3>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="mb-4">
                                <label class="block text-charcoal-light mb-1">Your Rating</label>
                                <div id="review-stars" class="flex items-center gap-1" data-rating="0">
                                    ${renderStars(0)}
                                </div>
                            </div>
                            <div class="mb-4"><label for="review-comment" class="block text-charcoal-light mb-1">Your Review</label><textarea id="review-comment" rows="4" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary"></textarea></div>
                            <div class="flex items-center justify-between">
                                <button id="submit-review-btn" class="bg-primary text-white font-semibold py-2 px-6 rounded-lg hover:bg-primary-dark">Submit Review</button>
                                <div id="review-confirmation" class="text-green-600 opacity-0 font-semibold">Thank you for your review!</div>
                            </div>
                        </div>
                    </div>
                `;
                showPage('product-detail');
                lucide.createIcons();
            };
            
            const renderCartPage = () => {
                if (cart.length === 0) {
                    elements.cartItemsContainer.innerHTML = '<div class="bg-white p-6 rounded-lg shadow-md"><p class="text-charcoal-light text-center">Your cart is empty.</p></div>';
                    elements.cartSummaryContainer.innerHTML = '';
                    return;
                }
                elements.cartItemsContainer.innerHTML = cart.map(item => `<div class="bg-white rounded-lg shadow-md p-4 mb-4 flex flex-col sm:flex-row items-center sm:justify-between"><div class="flex items-center gap-4 mb-4 sm:mb-0"><img src="${item.image}" alt="${item.name}" class="w-20 h-20 object-cover rounded-md"><div><h3 class="font-semibold text-charcoal">${item.name}</h3><p class="text-charcoal-light">$${item.price.toFixed(2)}</p></div></div><div class="flex items-center gap-4"><div class="flex items-center border rounded-md"><button class="update-quantity-btn p-2" data-id="${item.id}" data-change="-1">-</button><span class="px-4">${item.quantity}</span><button class="update-quantity-btn p-2" data-id="${item.id}" data-change="1">+</button></div><p class="font-semibold w-20 text-right">$${(item.price * item.quantity).toFixed(2)}</p><button class="remove-from-cart-btn text-red-500 hover:text-red-700" data-id="${item.id}"><i data-lucide="trash-2" class="w-5 h-5"></i></button></div></div>`).join('');
                const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                const tax = subtotal * 0.1;
                const total = subtotal + tax;
                elements.cartSummaryContainer.innerHTML = `<h2 class="text-xl font-bold text-charcoal mb-4">Cart Summary</h2><div class="space-y-2"><div class="flex justify-between"><p>Subtotal:</p><p>$${subtotal.toFixed(2)}</p></div><div class="flex justify-between"><p>Tax (10%):</p><p>$${tax.toFixed(2)}</p></div><div class="flex justify-between font-bold text-lg border-t pt-2 mt-2"><p>Total:</p><p>$${total.toFixed(2)}</p></div></div><button class="w-full mt-6 bg-primary text-white py-3 rounded-lg hover:bg-primary-dark transition-colors">Proceed to Checkout</button>`;
                lucide.createIcons();
            };

            const renderFilterButtons = () => {
                const categories = ['All', ...new Set(products.map(p => p.category))];
                elements.filterContainer.innerHTML = categories.map(cat => `<button class="filter-btn px-4 py-2 rounded-full text-sm font-semibold transition-colors" data-category="${cat}">${cat}</button>`).join('');
            };

            const updateCartCount = () => {
                elements.cartCountElement.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
            };

            const addToCart = (productId) => {
                const product = products.find(p => p.id === parseInt(productId));
                const existingItem = cart.find(item => item.id === product.id);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                updateCartCount();
            };

            const updateQuantity = (productId, change) => {
                const item = cart.find(i => i.id === parseInt(productId));
                if (item) {
                    item.quantity += parseInt(change);
                    if (item.quantity <= 0) {
                        removeFromCart(productId);
                    } else {
                        updateCartCount();
                        renderCartPage();
                    }
                }
            };
            
            const removeFromCart = (productId) => {
                cart = cart.filter(item => item.id !== parseInt(productId));
                updateCartCount();
                renderCartPage();
            };
            
            const submitReview = () => {
                const starsContainer = document.getElementById('review-stars');
                const commentEl = document.getElementById('review-comment');
                
                const rating = parseInt(starsContainer.dataset.rating);
                const comment = commentEl.value.trim();
                
                if (rating === 0) {
                    alert('Please select a star rating.');
                    return;
                }
                if (comment === '') {
                    alert('Please enter a comment for your review.');
                    return;
                }

                const product = products.find(p => p.id === currentProductId);
                if (product) {
                    const newReview = {
                        rating,
                        comment,
                        author: 'You',
                        date: new Date().toISOString().split('T')[0],
                        isNew: true,
                    };
                    product.sampleReviews.unshift(newReview);
                    product.reviews++;
                    
                    // Re-render the entire page to reflect all changes, including the new review count
                    renderProductDetailPage(currentProductId);

                    // Show confirmation on the newly rendered page
                    const confirmationEl = document.getElementById('review-confirmation');
                    if(confirmationEl) {
                        confirmationEl.classList.remove('opacity-0');
                        setTimeout(() => {
                            confirmationEl.classList.add('opacity-0');
                        }, 3000);
                    }
                }
            };

            // ---- CORRECTED EVENT LISTENER ----
            document.body.addEventListener('click', (e) => {
                // --- Star Rating Click Handler ---
                // First, check if a star in the review form was clicked.
                const star = e.target.closest('#review-stars .star');
                if (star) {
                    const starsContainer = document.getElementById('review-stars');
                    const rating = parseInt(star.dataset.index);
                    starsContainer.dataset.rating = rating;
                    // Re-render the stars with the new rating. The `renderStars` function correctly
                    // applies the 'star' and 'filled' classes needed for interaction.
                    starsContainer.innerHTML = renderStars(rating);
                    lucide.createIcons();
                    return; // Stop further execution since we've handled the click.
                }

                // --- Button and Link Click Handler ---
                // If a star wasn't clicked, check for other interactive elements.
                const target = e.target.closest('button, a');
                if (!target) return; // Exit if the click was not on any other button or link.

                if (target.matches('.add-to-cart-btn')) {
                    addToCart(target.dataset.id);
                }
                if (target.matches('.view-product-btn')) {
                    renderProductDetailPage(target.dataset.id);
                }
                if (target.matches('.update-quantity-btn')) {
                    updateQuantity(target.dataset.id, target.dataset.change);
                }
                if (target.matches('.remove-from-cart-btn')) {
                    removeFromCart(target.dataset.id);
                }
                if (target.matches('.filter-btn')) {
                    renderShopPage(target.dataset.category);
                }
                if (target.matches('#submit-review-btn')) {
                    submitReview();
                }
                
                // Handle navigation link clicks
                if (target.matches('.nav-link')) {
                    e.preventDefault();
                    const targetPage = target.dataset.target;
                    if (targetPage === 'cart') {
                        renderCartPage();
                    }
                    showPage(targetPage);
                }

                // Handle mobile menu toggle
                if (target.matches('#mobile-menu-button')) {
                    elements.mobileMenu.classList.toggle('hidden');
                }
            });

            // --- INITIALIZATION ---
            renderHomePage();
            renderFilterButtons();
            renderShopPage();
            lucide.createIcons();
            showPage('home');
        });
    </script>
</body>
</html>