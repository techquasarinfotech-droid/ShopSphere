<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopSphere - Modern E-Commerce</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@0.292.0/dist/umd/lucide.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        // Custom Tailwind CSS Configuration
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#0d9488', // A rich teal
                        'primary-dark': '#0f766e',
                        'secondary': '#f5f3f0', // A soft, warm off-white
                        'accent': '#facc15', // A vibrant yellow for highlights
                        'charcoal': '#1f2937', // A dark gray for text
                        'charcoal-light': '#4b5563',
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f3f0;
            color: #1f2937;
            /* Flexbox for sticky footer */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        /* Flex-grow for main content to push footer */
        main {
            flex-grow: 1;
        }
        .page { display: none; }
        .page.active { display: block; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .filter-btn.active {
            background-color: #0d9488; /* primary */
            color: white;
        }
        .star {
            color: #fde047; /* yellow-300 */
            cursor: pointer;
        }
        .star.filled {
             color: #facc15; /* accent */
        }
         .star-display {
            color: #facc15; /* accent */
        }
        #review-confirmation, #profile-save-confirmation {
            transition: opacity 0.5s ease-in-out;
        }
        /* Custom scrollbar for search results */
        #search-results-container::-webkit-scrollbar {
            width: 8px;
        }
        #search-results-container::-webkit-scrollbar-track {
            background: #f5f3f0;
        }
        #search-results-container::-webkit-scrollbar-thumb {
            background-color: #0d9488;
            border-radius: 20px;
            border: 3px solid #f5f3f0;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-40">
        <div class="container mx-auto px-4 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0"><a href="#" class="text-2xl font-bold text-charcoal nav-link" data-target="home">ShopSphere</a></div>
                <nav class="hidden md:flex items-center space-x-6">
                    <a href="#" class="text-charcoal-light hover:text-primary transition-colors nav-link" data-target="home">Home</a>
                    <a href="#" class="text-charcoal-light hover:text-primary transition-colors nav-link" data-target="shop">Shop</a>
                </nav>
                <div class="flex items-center space-x-4">
                    <button id="search-icon-btn" class="text-charcoal-light hover:text-primary"><i data-lucide="search" class="w-5 h-5"></i></button>
                    <a href="#" class="text-charcoal-light hover:text-primary nav-link" data-target="profile"><i data-lucide="user" class="w-5 h-5"></i></a>
                    <a href="#" class="relative text-charcoal-light hover:text-primary nav-link" data-target="cart">
                        <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-primary text-white text-xs w-4 h-4 rounded-full flex items-center justify-center">0</span>
                    </a>
                    <button id="mobile-menu-button" class="md:hidden text-charcoal-light hover:text-primary"><i data-lucide="menu" class="w-6 h-6"></i></button>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div id="home" class="page active">
            <section class="relative bg-charcoal text-white"><div class="absolute inset-0"><img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&w=1740&q=80" alt="Retail store interior" class="w-full h-full object-cover opacity-40"></div><div class="relative container mx-auto px-4 lg:px-8 py-24 md:py-32 text-center"><h1 class="text-4xl md:text-6xl font-bold mb-4 tracking-tight text-white">Style for Every Story</h1><p class="text-lg md:text-xl max-w-2xl mx-auto mb-8 text-gray-300">Discover curated collections that celebrate your unique style.</p><a href="#" class="bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-8 rounded-lg text-lg transition-transform transform hover:scale-105 nav-link" data-target="shop">Explore Collections</a></div></section>
            <section class="bg-white py-16 sm:py-20"><div class="container mx-auto px-4 lg:px-8"><div class="grid grid-cols-1 md:grid-cols-3 gap-12 text-center"><div class="flex flex-col items-center"><div class="bg-primary/10 p-4 rounded-full mb-4"><i data-lucide="truck" class="w-8 h-8 text-primary"></i></div><h3 class="text-xl font-bold text-charcoal mb-2">Free Shipping</h3><p class="text-charcoal-light">Enjoy free shipping on all orders over $50.</p></div><div class="flex flex-col items-center"><div class="bg-primary/10 p-4 rounded-full mb-4"><i data-lucide="shield-check" class="w-8 h-8 text-primary"></i></div><h3 class="text-xl font-bold text-charcoal mb-2">Secure Payments</h3><p class="text-charcoal-light">Your payments are processed securely.</p></div><div class="flex flex-col items-center"><div class="bg-primary/10 p-4 rounded-full mb-4"><i data-lucide="award" class="w-8 h-8 text-primary"></i></div><h3 class="text-xl font-bold text-charcoal mb-2">Quality Guarantee</h3><p class="text-charcoal-light">We stand by the quality of our products.</p></div></div></div></section>
            <section class="py-16 sm:py-20"><div class="container mx-auto px-4 lg:px-8"><h2 class="text-3xl font-bold text-center text-charcoal mb-10">Featured Products</h2><div id="featured-product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8"></div></div></section>
        </div>

        <div id="shop" class="page"><div class="container mx-auto px-4 lg:px-8 py-12"><h1 class="text-3xl font-bold text-charcoal mb-8">All Products</h1><div id="filter-container" class="flex flex-wrap gap-2 mb-8"></div><div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8"></div></div></div>

        <div id="product-detail" class="page"><div class="container mx-auto px-4 lg:px-8 py-12"><div id="product-detail-content"></div></div></div>

        <div id="cart" class="page"><div class="container mx-auto px-4 lg:px-8 py-12"><h1 class="text-3xl font-bold text-charcoal mb-8">Your Shopping Cart</h1><div class="lg:flex lg:gap-8"><div id="cart-items-container" class="lg:w-2/3"></div><div id="cart-summary-container" class="lg:w-1/3 mt-8 lg:mt-0"><div id="cart-summary" class="bg-white p-6 rounded-lg shadow-md sticky top-24"></div></div></div></div></div>

        <div id="profile" class="page">
            <div class="container mx-auto px-4 lg:px-8 py-12">
                <h1 class="text-3xl font-bold text-charcoal mb-8">My Account</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                    
                    <div class="lg:col-span-2 space-y-8">
                        <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md">
                            <div id="profile-view-mode">
                                <div class="flex items-center justify-between mb-6">
                                    <h2 class="text-2xl font-semibold text-charcoal">Personal Details</h2>
                                    <button id="edit-profile-btn" class="flex items-center gap-2 bg-primary/10 text-primary font-semibold py-2 px-4 rounded-lg hover:bg-primary/20 transition-colors">
                                        <i data-lucide="edit" class="w-4 h-4"></i> Edit
                                    </button>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-6">
                                    <div><h3 class="text-sm font-medium text-charcoal-light">Full Name</h3><p id="display-name" class="text-charcoal text-lg">Emily Carter</p></div>
                                    <div><h3 class="text-sm font-medium text-charcoal-light">Email Address</h3><p id="display-email" class="text-charcoal text-lg">emily.carter@example.com</p></div>
                                    <div><h3 class="text-sm font-medium text-charcoal-light">Phone Number</h3><p id="display-phone" class="text-charcoal text-lg">(555) 123-4567</p></div>
                                    <div><h3 class="text-sm font-medium text-charcoal-light">Shipping Address</h3><p id="display-address" class="text-charcoal text-lg">123 Market St, San Francisco, CA 94103</p></div>
                                </div>
                            </div>
                            <div id="profile-edit-mode" class="hidden">
                                <h2 class="text-2xl font-semibold text-charcoal mb-6">Edit Details</h2>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">
                                    <div>
                                        <label for="edit-name" class="block text-sm font-medium text-charcoal-light mb-1">Full Name</label>
                                        <input type="text" id="edit-name" value="Emily Carter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                                    </div>
                                     <div>
                                        <label for="edit-email" class="block text-sm font-medium text-charcoal-light mb-1">Email Address</label>
                                        <input type="email" id="edit-email" value="emily.carter@example.com" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                                    </div>
                                    <div>
                                        <label for="edit-phone" class="block text-sm font-medium text-charcoal-light mb-1">Phone Number</label>
                                        <input type="tel" id="edit-phone" value="(555) 123-4567" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                                    </div>
                                    <div>
                                        <label for="edit-address" class="block text-sm font-medium text-charcoal-light mb-1">Shipping Address</label>
                                        <input type="text" id="edit-address" value="123 Market St, San Francisco, CA 94103" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                                    </div>
                                </div>
                                <div class="flex items-center justify-end gap-4 mt-6">
                                    <button id="cancel-edit-btn" class="text-charcoal-light font-semibold py-2 px-4 rounded-lg hover:bg-gray-100">Cancel</button>
                                    <button id="save-profile-btn" class="bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-6 rounded-lg">Save Changes</button>
                                </div>
                                <div id="profile-save-confirmation" class="text-green-600 mt-4 text-right opacity-0 transition-opacity font-semibold">Profile updated successfully!</div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md">
                           <h2 class="text-2xl font-semibold text-charcoal mb-6">Order History</h2>
                           <div class="space-y-4">
                               <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between border-b border-gray-200 pb-4">
                                   <div class="mb-2 sm:mb-0">
                                       <p class="font-semibold text-charcoal">Order #SHP582A4</p>
                                       <p class="text-sm text-charcoal-light">Date: 2025-07-22</p>
                                   </div>
                                   <div class="flex items-center gap-4">
                                       <span class="font-bold text-charcoal">$110.00</span>
                                       <span class="text-xs font-medium bg-green-100 text-green-800 px-2 py-1 rounded-full">Delivered</span>
                                       <button class="text-primary hover:underline text-sm font-semibold">View Details</button>
                                   </div>
                               </div>
                               <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between border-b border-gray-200 pb-4">
                                    <div class="mb-2 sm:mb-0">
                                       <p class="font-semibold text-charcoal">Order #SHP519F8</p>
                                       <p class="text-sm text-charcoal-light">Date: 2025-06-12</p>
                                   </div>
                                   <div class="flex items-center gap-4">
                                       <span class="font-bold text-charcoal">$89.00</span>
                                       <span class="text-xs font-medium bg-green-100 text-green-800 px-2 py-1 rounded-full">Delivered</span>
                                       <button class="text-primary hover:underline text-sm font-semibold">View Details</button>
                                   </div>
                               </div>
                               <button class="text-primary hover:underline font-semibold mt-4">View all orders</button>
                           </div>
                        </div>
                    </div>

                    <div class="lg:col-span-1 space-y-8">
                        <div class="bg-white p-8 rounded-lg shadow-md text-center">
                            <img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=150&q=80" alt="User Avatar" class="w-32 h-32 rounded-full object-cover mx-auto mb-4 border-4 border-secondary">
                            <h2 id="display-name-avatar" class="text-xl font-semibold text-charcoal">Emily Carter</h2>
                            <p class="text-charcoal-light text-sm">Joined on July 20, 2024</p>
                        </div>
                        <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md">
                            <h2 class="text-xl font-semibold text-charcoal mb-4">Account Settings</h2>
                            <div class="space-y-1">
                                 <button id="change-password-btn" class="w-full text-left text-charcoal-light hover:text-primary transition-colors p-2 rounded-md hover:bg-secondary">Change Password</button>
                                 <button id="manage-addresses-btn" class="w-full text-left text-charcoal-light hover:text-primary transition-colors p-2 rounded-md hover:bg-secondary">Manage Addresses</button>
                                 <button class="w-full text-left text-red-600 hover:text-red-800 font-semibold p-2 rounded-md hover:bg-red-50">Logout</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="bg-charcoal text-gray-300 mt-16"><div class="container mx-auto px-4 lg:px-8 py-12"><div class="border-t border-gray-700 pt-6 text-center text-gray-500"><p>&copy; 2025 ShopSphere. All Rights Reserved.</p></div></div></footer>

    <div id="search-modal" class="modal fixed inset-0 z-50 items-start justify-center p-4 pt-[20vh] bg-black/50 backdrop-blur-sm">
        <div class="bg-secondary rounded-lg shadow-xl w-full max-w-2xl relative">
            <button class="close-modal-btn absolute -top-2 -right-2 text-white bg-primary rounded-full p-1"><i data-lucide="x" class="w-6 h-6"></i></button>
            <div class="p-4">
                <input id="search-input" type="text" placeholder="Search for products..." class="w-full text-lg p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
            <div id="search-results-container" class="p-4 max-h-[50vh] overflow-y-auto">
                 <p id="search-placeholder" class="text-center text-charcoal-light py-8">Start typing to see product results.</p>
            </div>
        </div>
    </div>

    <div id="password-modal" class="modal fixed inset-0 z-50 items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md relative p-8">
            <button class="close-modal-btn absolute top-4 right-4 text-charcoal-light hover:text-primary"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 class="text-2xl font-bold text-charcoal mb-6">Change Password</h2>
            <div class="space-y-4">
                <div>
                    <label for="current-password" class="block text-sm font-medium text-charcoal-light mb-1">Current Password</label>
                    <input type="password" id="current-password" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                </div>
                <div>
                    <label for="new-password" class="block text-sm font-medium text-charcoal-light mb-1">New Password</label>
                    <input type="password" id="new-password" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                </div>
                <div>
                    <label for="confirm-password" class="block text-sm font-medium text-charcoal-light mb-1">Confirm New Password</label>
                    <input type="password" id="confirm-password" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary">
                </div>
            </div>
            <div class="flex items-center justify-end gap-4 mt-8">
                <button class="close-modal-btn text-charcoal-light font-semibold py-2 px-4 rounded-lg hover:bg-gray-100">Cancel</button>
                <button id="save-password-btn" class="bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-6 rounded-lg">Save Password</button>
            </div>
        </div>
    </div>
    
    <div id="address-modal" class="modal fixed inset-0 z-50 items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
         <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl relative p-8">
            <button class="close-modal-btn absolute top-4 right-4 text-charcoal-light hover:text-primary"><i data-lucide="x" class="w-6 h-6"></i></button>
            <h2 class="text-2xl font-bold text-charcoal mb-6">Manage Addresses</h2>
            <div class="space-y-4">
                <div class="border border-primary rounded-lg p-4 bg-primary/5">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-bold text-charcoal">Primary: Emily Carter</p>
                            <p class="text-charcoal-light">123 Market St, San Francisco, CA 94103</p>
                            <p class="text-charcoal-light">(555) 123-4567</p>
                        </div>
                        <span class="text-xs font-medium text-primary py-1 px-2 border border-primary rounded-full">Default</span>
                    </div>
                </div>
                <button id="add-new-address-form-btn" class="w-full text-primary border-2 border-dashed border-gray-300 hover:border-primary hover:bg-primary/5 p-4 rounded-lg flex items-center justify-center gap-2 transition-colors">
                     <i data-lucide="plus" class="w-5 h-5"></i> Add New Address
                </button>
                <div id="new-address-form" class="hidden pt-4 mt-4 border-t">
                    <h3 class="text-xl font-semibold text-charcoal mb-4">New Address Details</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                         <div>
                            <label class="block text-sm font-medium text-charcoal-light mb-1">Full Name</label>
                            <input type="text" placeholder="Full Name" class="w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-charcoal-light mb-1">Phone Number</label>
                            <input type="tel" placeholder="(555) 555-5555" class="w-full p-2 border border-gray-300 rounded-md">
                        </div>
                         <div class="sm:col-span-2">
                            <label class="block text-sm font-medium text-charcoal-light mb-1">Street Address</label>
                            <input type="text" placeholder="123 Main St" class="w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-charcoal-light mb-1">City</label>
                            <input type="text" placeholder="City" class="w-full p-2 border border-gray-300 rounded-md">
                        </div>
                         <div>
                            <label class="block text-sm font-medium text-charcoal-light mb-1">State</label>
                            <input type="text" placeholder="State" class="w-full p-2 border border-gray-300 rounded-md">
                        </div>
                         <div>
                            <label class="block text-sm font-medium text-charcoal-light mb-1">Zip Code</label>
                            <input type="text" placeholder="Zip Code" class="w-full p-2 border border-gray-300 rounded-md">
                        </div>
                    </div>
                    <div class="flex justify-end gap-4 mt-4">
                         <button id="cancel-new-address-btn" class="text-charcoal-light font-semibold py-2 px-4 rounded-lg hover:bg-gray-100">Cancel</button>
                         <button id="save-new-address-btn" class="bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-6 rounded-lg">Save Address</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA ---
             const products = [
                { id: 1, name: 'Chronos Smartwatch', price: 299.00, image: 'https://images.unsplash.com/photo-1546868871-7041f2a55e12?auto=format&fit=crop&w=800&q=80', category: 'Electronics', rating: 4.8, reviews: 120, description: 'A stylish and powerful smartwatch to keep you connected.', sampleReviews: [{rating: 5, author: 'Alex J.', date: '2024-07-15', comment: 'Absolutely love it! The battery life is amazing and it looks so sleek.'}, {rating: 4, author: 'Maria S.', date: '2024-07-10', comment: 'Great watch, but the strap could be more comfortable.'}] },
                { id: 2, name: 'Aura Headphones', price: 149.00, image: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=800&q=80', category: 'Electronics', rating: 4.6, reviews: 98, description: 'Immerse yourself in high-fidelity sound.', sampleReviews: [{rating: 5, author: 'David L.', date: '2024-06-28', comment: 'The noise cancellation is top-notch. Perfect for my commute.'}] },
                { id: 3, name: 'Nomad Leather Backpack', price: 189.00, image: 'https://images.pexels.com/photos/3155047/pexels-photo-3155047.jpeg?auto=format&fit=crop&w=800&q=80', category: 'Accessories', rating: 4.9, reviews: 215, description: 'Crafted from genuine leather for your adventures.', sampleReviews: [{rating: 5, author: 'Jessica P.', date: '2024-07-20', comment: 'Stunning backpack. The quality of the leather is incredible and it has so many useful pockets.'}, {rating: 5, author: 'Tom B.', date: '2024-07-18', comment: 'Best backpack I have ever owned. Worth every penny.'}] },
                { id: 4, name: 'Eclipse Sunglasses', price: 79.00, image: 'https://images.unsplash.com/photo-1511499767150-a48a237f0083?auto=format&fit=crop&w=800&q=80', category: 'Accessories', rating: 4.5, reviews: 75, onSale: true, description: 'Protect your eyes with style and 100% UV protection.', sampleReviews: [{rating: 4, author: 'Samantha G.', date: '2024-05-30', comment: 'Very stylish and lightweight. I wish they came with a harder case.'}] },
                { id: 5, name: 'Modern Ceramic Vase', price: 45.00, image: 'https://images.pexels.com/photos/6633404/pexels-photo-6633404.jpeg?auto=format&fit=crop&w=800&q=80', category: 'Home Goods', rating: 4.7, reviews: 62, description: 'A beautiful minimalist vase to add a touch of elegance.', sampleReviews: [{rating: 5, author: 'Olivia W.', date: '2024-07-05', comment: 'Looks perfect on my mantlepiece. The matte finish is very chic.'}] },
                { id: 6, name: 'Cozy Knit Blanket', price: 89.00, image: 'https://images.unsplash.com/photo-1580301762395-21ce84d00bc6?auto=format&fit=crop&w=800&q=80', category: 'Home Goods', rating: 4.8, reviews: 150, description: 'Stay warm with this ultra-soft, chunky knit blanket.', sampleReviews: [{rating: 5, author: 'Ben K.', date: '2024-06-12', comment: 'So soft and warm! My new favorite blanket for movie nights.'}] },
                { id: 7, name: 'Classic White Tee', price: 29.00, image: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?auto=format&fit=crop&w=800&q=80', category: 'Apparel', rating: 4.4, reviews: 88, description: 'A timeless wardrobe staple made from 100% organic cotton.', sampleReviews: [{rating: 4, author: 'Chloe T.', date: '2024-07-11', comment: 'Great quality cotton, but it runs a little large.'}] },
                { id: 8, name: 'Denim Jacket', price: 110.00, image: 'https://images.pexels.com/photos/2344601/pexels-photo-2344601.jpeg?auto=format&fit=crop&w=800&q=80', category: 'Apparel', rating: 4.9, reviews: 301, onSale: true, description: 'The perfect layering piece for any season.', sampleReviews: [{rating: 5, author: 'Michael R.', date: '2024-07-22', comment: 'I wear this jacket everywhere. It fits perfectly and the denim is high quality.'}] }
            ]; 
            let cart = [];
            let currentProductId = null;

            const elements = {
                pages: document.querySelectorAll('.page'),
                modals: document.querySelectorAll('.modal'),
                navLinks: document.querySelectorAll('.nav-link'),
                mobileMenuButton: document.getElementById('mobile-menu-button'),
                mobileMenu: document.getElementById('mobile-menu'),
                productListContainer: document.getElementById('product-list'),
                featuredProductListContainer: document.getElementById('featured-product-list'),
                productDetailContainer: document.getElementById('product-detail-content'),
                cartItemsContainer: document.getElementById('cart-items-container'),
                cartSummaryContainer: document.getElementById('cart-summary'),
                cartCountElement: document.getElementById('cart-count'),
                filterContainer: document.getElementById('filter-container'),
                profileViewMode: document.getElementById('profile-view-mode'),
                profileEditMode: document.getElementById('profile-edit-mode'),
                displayName: document.getElementById('display-name'),
                displayEmail: document.getElementById('display-email'),
                displayPhone: document.getElementById('display-phone'),
                displayAddress: document.getElementById('display-address'),
                displayNameAvatar: document.getElementById('display-name-avatar'),
                editName: document.getElementById('edit-name'),
                editEmail: document.getElementById('edit-email'),
                editPhone: document.getElementById('edit-phone'),
                editAddress: document.getElementById('edit-address'),
                searchInput: document.getElementById('search-input'),
                searchResultsContainer: document.getElementById('search-results-container'),
                searchPlaceholder: document.getElementById('search-placeholder'),
                newAddressForm: document.getElementById('new-address-form'),
            };

            const openModal = (modalId) => {
                const modal = document.getElementById(modalId);
                if(modal) modal.classList.add('active');
            };
            
            const closeModal = () => {
                elements.modals.forEach(modal => modal.classList.remove('active'));
            };

            const showPage = (pageId) => {
                elements.pages.forEach(page => page.classList.toggle('active', page.id === pageId));
                window.scrollTo(0, 0);
                elements.mobileMenu.classList.add('hidden');
                closeModal(); // Close any open modals when navigating
            };

            const renderStars = (rating, isDisplayOnly = false) => {
                let starsHTML = '';
                const fullStars = Math.floor(rating);
                const halfStar = !isDisplayOnly ? false : rating % 1 >= 0.5;
                const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
                for (let i = 0; i < fullStars; i++) 
                    starsHTML += `<i data-lucide="star" class="w-4 h-4 ${isDisplayOnly ? 'star-display' : 'star filled'} fill-current" data-index="${i + 1}"></i>`;
                if (halfStar) 
                    starsHTML += `<i data-lucide="star-half" class="w-4 h-4 star-display fill-current"></i>`;
                for (let i = 0; i < emptyStars; i++) 
                    starsHTML += `<i data-lucide="star" class="w-4 h-4 ${isDisplayOnly ? 'text-gray-300' : 'star'}" data-index="${fullStars + i + 1}"></i>`;
                return starsHTML;
            };
            
            const renderProductCard = (product, isSearchResult = false) => {
                const buttonClass = isSearchResult ? 'view-product-from-search-btn' : 'view-product-btn';
                return `
                <div class="bg-white rounded-lg shadow-md overflow-hidden group">
                    <div class="relative"><img src="${product.image}" alt="${product.name}" class="w-full h-64 object-cover">${product.onSale ? '<div class="absolute top-2 left-2 bg-accent text-charcoal text-xs font-bold px-2 py-1 rounded">SALE</div>' : ''}<div class="absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity"><button class="${buttonClass} bg-white text-charcoal p-3 rounded-full hover:bg-primary hover:text-white transition-colors" data-id="${product.id}"><i data-lucide="eye" class="w-5 h-5"></i></button><button class="add-to-cart-btn bg-white text-charcoal p-3 rounded-full hover:bg-primary hover:text-white transition-colors" data-id="${product.id}"><i data-lucide="shopping-cart" class="w-5 h-5"></i></button></div></div>
                    <div class="p-4"><h3 class="font-semibold text-charcoal">${product.name}</h3><div class="flex items-center mt-1"><div class="flex items-center">${renderStars(product.rating, true)}</div><span class="text-xs text-charcoal-light ml-2">(${product.reviews})</span></div><p class="text-primary font-bold mt-2">$${product.price.toFixed(2)}</p></div>
                </div>`;
            }

            const renderShopPage = (category = 'All') => {
                const filteredProducts = category === 'All' ? products : products.filter(p => p.category === category);
                elements.productListContainer.innerHTML = filteredProducts.map(p => renderProductCard(p, false)).join('');
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.category === category));
                lucide.createIcons();
            };

            const renderHomePage = () => {
                const featuredProducts = products.filter(p => p.onSale || p.rating > 4.8).slice(0, 4);
                elements.featuredProductListContainer.innerHTML = featuredProducts.map(p => renderProductCard(p, false)).join('');
                lucide.createIcons();
            };

            const renderReviews = (product) => {
                if (!product.sampleReviews || product.sampleReviews.length === 0) {
                    return '<p class="text-charcoal-light">No reviews yet.</p>';
                }
                return product.sampleReviews.map(review => `
                    <div class="border-t border-gray-200 pt-4 mt-4">
                        <div class="flex items-center mb-1">
                            <div class="flex">${renderStars(review.rating, true)}</div>
                            <h4 class="font-semibold text-charcoal ml-3">${review.author}</h4>
                            ${review.isNew ? '<span class="ml-2 bg-green-100 text-green-800 text-xs font-medium px-2 py-0.5 rounded">New</span>' : ''}
                        </div>
                        <p class="text-xs text-gray-500 mb-2">${review.date}</p>
                        <p class="text-charcoal-light">${review.comment}</p>
                    </div>
                `).join('');
            };

            const renderProductDetailPage = (productId) => {
                currentProductId = parseInt(productId);
                const product = products.find(p => p.id === currentProductId);
                if (!product) return;
                elements.productDetailContainer.innerHTML = `
                    <button class="nav-link mb-8 flex items-center gap-2 text-charcoal-light hover:text-primary font-semibold" data-target="shop"><i data-lucide="arrow-left" class="w-4 h-4"></i> Back to Shop</button>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-start">
                        <div><img src="${product.image}" alt="${product.name}" class="w-full rounded-lg shadow-md object-cover"></div>
                        <div><h1 class="text-4xl font-bold text-charcoal mb-2">${product.name}</h1><div class="flex items-center gap-2 mb-4"><div class="flex items-center">${renderStars(product.rating, true)}</div><a href="#reviews" class="text-charcoal-light hover:text-primary">${product.reviews} reviews</a></div><p class="text-3xl text-primary font-bold mb-6">$${product.price.toFixed(2)}</p><p class="text-charcoal-light mb-6">${product.description}</p><button class="add-to-cart-btn w-full bg-primary text-white py-3 rounded-lg hover:bg-primary-dark transition-colors text-lg" data-id="${product.id}">Add to Cart</button></div>
                    </div>
                    <div id="reviews" class="mt-16">
                        <h2 class="text-2xl font-bold text-charcoal mb-6">Customer Reviews</h2>
                        <div id="review-list" class="bg-white p-6 rounded-lg shadow-md mb-8">
                            ${renderReviews(product)}
                        </div>
                        <h3 class="text-xl font-bold text-charcoal mb-4">Write a Review</h3>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="mb-4">
                                <label class="block text-charcoal-light mb-1">Your Rating</label>
                                <div id="review-stars" class="flex items-center gap-1" data-rating="0">
                                    ${renderStars(0)}
                                </div>
                            </div>
                            <div class="mb-4"><label for="review-comment" class="block text-charcoal-light mb-1">Your Review</label><textarea id="review-comment" rows="4" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary"></textarea></div>
                            <div class="flex items-center justify-between">
                                <button id="submit-review-btn" class="bg-primary text-white font-semibold py-2 px-6 rounded-lg hover:bg-primary-dark">Submit Review</button>
                                <div id="review-confirmation" class="text-green-600 opacity-0 font-semibold">Thank you for your review!</div>
                            </div>
                        </div>
                    </div>
                `;
                showPage('product-detail');
                lucide.createIcons();
            };
            
            const renderCartPage = () => {
                if (cart.length === 0) {
                    elements.cartItemsContainer.innerHTML = '<div class="bg-white p-6 rounded-lg shadow-md h-full flex items-center justify-center"><p class="text-charcoal-light text-center">Your cart is empty.</p></div>';
                    elements.cartSummaryContainer.innerHTML = '';
                    return;
                }
                elements.cartItemsContainer.innerHTML = cart.map(item => `<div class="bg-white rounded-lg shadow-md p-4 mb-4 flex flex-col sm:flex-row items-center sm:justify-between"><div class="flex items-center gap-4 mb-4 sm:mb-0"><img src="${item.image}" alt="${item.name}" class="w-20 h-20 object-cover rounded-md"><div><h3 class="font-semibold text-charcoal">${item.name}</h3><p class="text-charcoal-light">$${item.price.toFixed(2)}</p></div></div><div class="flex items-center gap-4"><div class="flex items-center border rounded-md"><button class="update-quantity-btn p-2" data-id="${item.id}" data-change="-1">-</button><span class="px-4">${item.quantity}</span><button class="update-quantity-btn p-2" data-id="${item.id}" data-change="1">+</button></div><p class="font-semibold w-20 text-right">$${(item.price * item.quantity).toFixed(2)}</p><button class="remove-from-cart-btn text-red-500 hover:text-red-700" data-id="${item.id}"><i data-lucide="trash-2" class="w-5 h-5"></i></button></div></div>`).join('');
                const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                const tax = subtotal * 0.1;
                const total = subtotal + tax;
                elements.cartSummaryContainer.innerHTML = `<h2 class="text-xl font-bold text-charcoal mb-4">Cart Summary</h2><div class="space-y-2"><div class="flex justify-between"><p>Subtotal:</p><p>$${subtotal.toFixed(2)}</p></div><div class="flex justify-between"><p>Tax (10%):</p><p>$${tax.toFixed(2)}</p></div><div class="flex justify-between font-bold text-lg border-t pt-2 mt-2"><p>Total:</p><p>$${total.toFixed(2)}</p></div></div><button class="w-full mt-6 bg-primary text-white py-3 rounded-lg hover:bg-primary-dark transition-colors">Proceed to Checkout</button>`;
                lucide.createIcons();
            };

            const renderFilterButtons = () => {
                const categories = ['All', ...new Set(products.map(p => p.category))];
                elements.filterContainer.innerHTML = categories.map(cat => `<button class="filter-btn px-4 py-2 rounded-full text-sm font-semibold transition-colors" data-category="${cat}">${cat}</button>`).join('');
            };

            const updateCartCount = () => {
                elements.cartCountElement.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
            };

            const addToCart = (productId) => {
                const product = products.find(p => p.id === parseInt(productId));
                const existingItem = cart.find(item => item.id === product.id);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                updateCartCount();
            };

            const updateQuantity = (productId, change) => {
                const item = cart.find(i => i.id === parseInt(productId));
                if (item) {
                    item.quantity += parseInt(change);
                    if (item.quantity <= 0) {
                        removeFromCart(productId);
                    } else {
                        updateCartCount();
                        renderCartPage();
                    }
                }
            };
            
            const removeFromCart = (productId) => {
                cart = cart.filter(item => item.id !== parseInt(productId));
                updateCartCount();
                renderCartPage();
            };
            
            const submitReview = () => {
                const starsContainer = document.getElementById('review-stars');
                const commentEl = document.getElementById('review-comment');
                const rating = parseInt(starsContainer.dataset.rating);
                const comment = commentEl.value.trim();
                
                if (rating === 0 || comment === '') {
                    alert('Please provide a rating and a comment.');
                    return;
                }

                const product = products.find(p => p.id === currentProductId);
                if (product) {
                    product.sampleReviews.unshift({ rating, comment, author: 'You', date: new Date().toISOString().split('T')[0], isNew: true });
                    product.reviews++;
                    renderProductDetailPage(currentProductId);
                    const confirmationEl = document.getElementById('review-confirmation');
                    if(confirmationEl) {
                        confirmationEl.classList.remove('opacity-0');
                        setTimeout(() => confirmationEl.classList.add('opacity-0'), 3000);
                    }
                }
            };

            const setProfileEditMode = (isEditing) => {
                elements.profileViewMode.classList.toggle('hidden', isEditing);
                elements.profileEditMode.classList.toggle('hidden', !isEditing);
            };

            const saveProfileChanges = () => {
                elements.displayName.textContent = elements.editName.value;
                elements.displayNameAvatar.textContent = elements.editName.value;
                elements.displayEmail.textContent = elements.editEmail.value;
                elements.displayPhone.textContent = elements.editPhone.value;
                elements.displayAddress.textContent = elements.editAddress.value;
                setProfileEditMode(false);
                const confirmationEl = document.getElementById('profile-save-confirmation');
                if (confirmationEl) {
                    confirmationEl.classList.remove('opacity-0');
                    setTimeout(() => confirmationEl.classList.add('opacity-0'), 3000);
                }
            };
            
            // --- EVENT LISTENERS ---
            document.body.addEventListener('click', (e) => {
                const target = e.target.closest('button, a');
                
                // Modal Close Logic
                if (e.target.closest('.close-modal-btn') || e.target.matches('.modal')) {
                    closeModal();
                    return;
                }
                
                if (!target) return; // Exit if click is not on a button or link

                // --- Modal Triggers ---
                if (target.matches('#search-icon-btn')) openModal('search-modal');
                if (target.matches('#change-password-btn')) openModal('password-modal');
                if (target.matches('#manage-addresses-btn')) openModal('address-modal');
                if (target.matches('#add-new-address-form-btn')) {
                    elements.newAddressForm.classList.remove('hidden');
                    target.classList.add('hidden');
                }
                if (target.matches('#cancel-new-address-btn')) {
                    elements.newAddressForm.classList.add('hidden');
                    document.getElementById('add-new-address-form-btn').classList.remove('hidden');
                }

                // --- Page and Component Actions ---
                if (target.matches('#edit-profile-btn')) setProfileEditMode(true);
                if (target.matches('#save-profile-btn')) saveProfileChanges();
                if (target.matches('#cancel-edit-btn')) setProfileEditMode(false);

                if (target.matches('.add-to-cart-btn')) addToCart(target.dataset.id);
                if (target.matches('.view-product-btn')) renderProductDetailPage(target.dataset.id);
                if (target.matches('.view-product-from-search-btn')) renderProductDetailPage(target.dataset.id);
                if (target.matches('.update-quantity-btn')) updateQuantity(target.dataset.id, target.dataset.change);
                if (target.matches('.remove-from-cart-btn')) removeFromCart(target.dataset.id);
                if (target.matches('.filter-btn')) renderShopPage(target.dataset.category);
                if (target.matches('#submit-review-btn')) submitReview();
                
                if (target.matches('.nav-link')) {
                    e.preventDefault();
                    if (target.dataset.target === 'cart') renderCartPage();
                    showPage(target.dataset.target);
                }

                if (target.matches('#mobile-menu-button')) elements.mobileMenu.classList.toggle('hidden');

                if (target.matches('#save-password-btn')) {
                    const newPass = document.getElementById('new-password').value;
                    const confirmPass = document.getElementById('confirm-password').value;
                    if (newPass && newPass === confirmPass) {
                        alert('Password changed successfully! (Simulation)');
                        closeModal();
                    } else {
                        alert('New passwords do not match.');
                    }
                }
                
                if (target.matches('#save-new-address-btn')) {
                    alert('New address saved! (Simulation)');
                    elements.newAddressForm.classList.add('hidden');
                    document.getElementById('add-new-address-form-btn').classList.remove('hidden');
                    closeModal();
                }

                // Star rating handler
                const star = e.target.closest('#review-stars .star');
                if (star) {
                    const starsContainer = document.getElementById('review-stars');
                    const rating = parseInt(star.dataset.index);
                    starsContainer.dataset.rating = rating;
                    starsContainer.innerHTML = renderStars(rating);
                    lucide.createIcons();
                }
            });
            
            // Search Input Listener
            elements.searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                if (query.length > 1) {
                    const results = products.filter(p => 
                        p.name.toLowerCase().includes(query) || 
                        p.description.toLowerCase().includes(query)
                    );
                    elements.searchPlaceholder.classList.add('hidden');
                    elements.searchResultsContainer.innerHTML = results.length
                        ? `<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">${results.map(p => renderProductCard(p, true)).join('')}</div>`
                        : '<p class="text-center text-charcoal-light py-8">No products found.</p>';
                } else {
                    elements.searchPlaceholder.classList.remove('hidden');
                    elements.searchResultsContainer.innerHTML = '';
                }
                lucide.createIcons();
            });

            // Close modal with Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === "Escape") closeModal();
            });

            // --- INITIALIZATION ---
            renderHomePage();
            renderFilterButtons();
            renderShopPage();
            lucide.createIcons();
            showPage('home');
        });
    </script>
</body>
</html>